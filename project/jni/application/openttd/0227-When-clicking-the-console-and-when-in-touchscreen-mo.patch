From 738750120f21c397e32391ed04e69648dc064738 Mon Sep 17 00:00:00 2001
From: Juanjo <juanjo.ng.83@gmail.com>
Date: Sun, 28 Jul 2013 11:44:10 +0000
Subject: [PATCH 227/249] When clicking the console and when in touchscreen
 modes, open a query string window.

---
 src/console_gui.cpp  | 19 +++++++++++++++++++
 src/lang/english.txt |  4 ++++
 2 files changed, 23 insertions(+)

diff --git a/src/console_gui.cpp b/src/console_gui.cpp
index c3dcdaa..031a490 100644
--- a/src/console_gui.cpp
+++ b/src/console_gui.cpp
@@ -22,6 +22,7 @@
 #include "console_func.h"
 #include "rev.h"
 #include "video/video_driver.hpp"
+#include "textbuf_gui.h"
 
 #include "widgets/console_widget.h"
 
@@ -227,6 +228,24 @@ struct IConsoleWindow : Window
 		}
 	}
 
+	virtual void OnClick(Point pt, int widget, int click_count)
+	{
+		if (_settings_client.gui.touchscreen_mode == 0) return;
+
+		ShowQueryString(STR_EMPTY, STR_CONSOLE_QUERY_STRING, ICON_CMDLN_SIZE,
+			this, CS_ALPHANUMERAL, QSF_NONE);
+	}
+
+	virtual void OnQueryTextFinished(char *str)
+	{
+		_focused_window = this;
+
+		if (str == NULL) return;
+
+		_iconsole_cmdline.Assign(str);
+		this->OnKeyPress(0, WKC_RETURN);
+	}
+
 	virtual void OnHundredthTick()
 	{
 		if (IConsoleLine::Truncate() &&
diff --git a/src/lang/english.txt b/src/lang/english.txt
index 9ca1c3e..be69bbb 100644
--- a/src/lang/english.txt
+++ b/src/lang/english.txt
@@ -2664,6 +2664,10 @@ STR_LAI_OBJECT_DESCRIPTION_LIGHTHOUSE                           :Lighthouse
 STR_LAI_OBJECT_DESCRIPTION_COMPANY_HEADQUARTERS                 :Company headquarters
 STR_LAI_OBJECT_DESCRIPTION_COMPANY_OWNED_LAND                   :Company-owned land
 
+# Console
+
+STR_CONSOLE_QUERY_STRING                                        :Enter a console command
+
 # About OpenTTD window
 STR_ABOUT_OPENTTD                                               :{WHITE}About OpenTTD
 STR_ABOUT_ORIGINAL_COPYRIGHT                                    :{BLACK}Original copyright {COPYRIGHT} 1995 Chris Sawyer, All rights reserved
-- 
1.8.1.2

