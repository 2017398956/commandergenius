From 7e4ef45b2c7703047ac2ba97ff5fc93cdc38fed5 Mon Sep 17 00:00:00 2001
From: Juanjo <juanjo.ng.83@gmail.com>
Date: Mon, 14 Oct 2013 19:24:30 +0000
Subject: [PATCH 238/249] Erase queued commands when another command is about
 to be queued.

---
 src/airport_gui.cpp   | 1 +
 src/dock_gui.cpp      | 1 +
 src/rail_gui.cpp      | 1 +
 src/road_gui.cpp      | 1 +
 src/terraform_gui.cpp | 1 +
 src/tree_gui.cpp      | 1 +
 6 files changed, 6 insertions(+)

diff --git a/src/airport_gui.cpp b/src/airport_gui.cpp
index fa9d1b7..4f1335b 100644
--- a/src/airport_gui.cpp
+++ b/src/airport_gui.cpp
@@ -103,6 +103,7 @@ struct BuildAirToolbarWindow : Window {
 
 	virtual void OnPlaceObject(Point pt, TileIndex tile)
 	{
+		EraseQueuedTouchCommand();
 		switch (this->last_user_action) {
 			case WID_AT_AIRPORT: {
 				VpStartPlaceSizing(tile, VPM_SINGLE_TILE, DDSP_BUILD_STATION);
diff --git a/src/dock_gui.cpp b/src/dock_gui.cpp
index 701a597..2962a09 100644
--- a/src/dock_gui.cpp
+++ b/src/dock_gui.cpp
@@ -168,6 +168,7 @@ struct BuildDocksToolbarWindow : Window {
 
 	virtual void OnPlaceObject(Point pt, TileIndex tile)
 	{
+		EraseQueuedTouchCommand();
 		switch (this->last_clicked_widget) {
 			case WID_DT_CANAL: // Build canal button
 				VpStartPlaceSizing(tile, (_game_mode == GM_EDITOR) ? VPM_X_AND_Y : VPM_X_OR_Y, DDSP_CREATE_WATER);
diff --git a/src/rail_gui.cpp b/src/rail_gui.cpp
index a0fa459..4e6a5d4 100644
--- a/src/rail_gui.cpp
+++ b/src/rail_gui.cpp
@@ -583,6 +583,7 @@ struct BuildRailToolbarWindow : Window {
 
 	virtual void OnPlaceObject(Point pt, TileIndex tile)
 	{
+		EraseQueuedTouchCommand();
 		switch (this->last_user_action) {
 			case WID_RAT_BUILD_NS:
 				VpStartPlaceSizing(tile, VPM_FIX_VERTICAL | VPM_RAILDIRS, DDSP_PLACE_RAIL);
diff --git a/src/road_gui.cpp b/src/road_gui.cpp
index 455eef1..1dc2eb7 100644
--- a/src/road_gui.cpp
+++ b/src/road_gui.cpp
@@ -467,6 +467,7 @@ struct BuildRoadToolbarWindow : Window {
 
 	virtual void OnPlaceObject(Point pt, TileIndex tile)
 	{
+		EraseQueuedTouchCommand();
 		_remove_button_clicked = this->IsWidgetLowered(WID_ROT_REMOVE);
 		_one_way_button_clicked = this->IsWidgetLowered(WID_ROT_ONE_WAY);
 		switch (this->last_started_action) {
diff --git a/src/terraform_gui.cpp b/src/terraform_gui.cpp
index c6b3dff..f8d7e0b 100644
--- a/src/terraform_gui.cpp
+++ b/src/terraform_gui.cpp
@@ -653,6 +653,7 @@ struct ScenarioEditorLandscapeGenerationWindow : Window {
 
 	virtual void OnPlaceObject(Point pt, TileIndex tile)
 	{
+		EraseQueuedTouchCommand();
 		switch (this->last_user_action) {
 			case WID_ETT_DEMOLISH: // Demolish aka dynamite button
 				PlaceProc_DemolishArea(tile);
diff --git a/src/tree_gui.cpp b/src/tree_gui.cpp
index eac8584..f57d67a 100644
--- a/src/tree_gui.cpp
+++ b/src/tree_gui.cpp
@@ -144,6 +144,7 @@ public:
 
 	virtual void OnPlaceObject(Point pt, TileIndex tile)
 	{
+		EraseQueuedTouchCommand();
 		VpStartPlaceSizing(tile, VPM_X_AND_Y, DDSP_PLANT_TREES);
 	}
 
-- 
1.8.1.2

